@model AdminDashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    ViewData["Breadcrumb"] = "<li class='breadcrumb-item active'>Dashboard</li>";
}

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="fas fa-users fa-2x text-primary"></i>
                </div>
                <div>
                    <div class="stats-number">@Model.TotalUsers</div>
                    <div class="stats-label">Tổng User</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="fas fa-film fa-2x text-success"></i>
                </div>
                <div>
                    <div class="stats-number">@Model.TotalMovies</div>
                    <div class="stats-label">Tổng Phim</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="fas fa-play-circle fa-2x text-warning"></i>
                </div>
                <div>
                    <div class="stats-number">@Model.TotalEpisodes</div>
                    <div class="stats-label">Tổng Tập</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="fas fa-user-check fa-2x text-info"></i>
                </div>
                <div>
                    <div class="stats-number">@Model.ActiveUsers</div>
                    <div class="stats-label">User Hoạt Động</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-xl-6 mb-4">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-pie me-2"></i>
                    Phân Loại User
                </h5>
            </div>
            <div class="card-body">
                <canvas id="userRoleChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-xl-6 mb-4">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>
                    Phim Theo Thể Loại
                </h5>
            </div>
            <div class="card-body">
                <canvas id="movieGenreChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="row">
    <div class="col-xl-8 mb-4">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5 class="mb-0">
                    <i class="fas fa-clock me-2"></i>
                    Phim Mới Nhất
                </h5>
            </div>
            <div class="card-body">
                @if (Model.RecentMovies.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Tên Phim</th>
                                    <th>Thể Loại</th>
                                    <th>Quốc Gia</th>
                                    <th>Ngày Tạo</th>
                                    <th>Thao Tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var movie in Model.RecentMovies)
                                {
                                    <tr>                                        <td>
                                            <strong>@movie.TenPhim</strong>
                                        </td>
                                        <td>
                                            @movie.TheLoaiPhim?.TenTL
                                        </td>
                                        <td>
                                            @movie.QuocGia?.TenQG
                                        </td>
                                        <td>
                                            @movie.NgayTao.ToString("dd/MM/yyyy")
                                        </td>
                                        <td>
                                            <a asp-area="Admin" asp-controller="Movies" asp-action="Details" asp-route-id="@movie.MaPhim" 
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted">Chưa có phim nào.</p>
                }
            </div>
        </div>
    </div>
    
    <div class="col-xl-4 mb-4">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5 class="mb-0">
                    <i class="fas fa-user-plus me-2"></i>
                    User Mới Nhất
                </h5>
            </div>
            <div class="card-body">
                @if (Model.RecentUsers.Any())
                {
                    @foreach (var user in Model.RecentUsers)
                    {
                        <div class="d-flex align-items-center mb-3">
                            <div class="user-avatar me-3">
                                @user.FullName.Substring(0, 1).ToUpper()
                            </div>
                            <div class="flex-grow-1">
                                <div class="fw-bold">@user.FullName</div>
                                <small class="text-muted">@user.Email</small>
                                <br>
                                <small class="text-muted">@user.CreatedAt.ToString("dd/MM/yyyy")</small>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted">Chưa có user mới.</p>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // User Role Chart
        const userRoleCtx = document.getElementById('userRoleChart').getContext('2d');
        const userRoleChart = new Chart(userRoleCtx, {
            type: 'doughnut',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.UsersByRole.Keys.Select(k => $"'{k}'")))],
                datasets: [{
                    data: [@string.Join(",", Model.UsersByRole.Values)],
                    backgroundColor: [
                        '#e74c3c',
                        '#f39c12', 
                        '#3498db'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Movie Genre Chart
        const movieGenreCtx = document.getElementById('movieGenreChart').getContext('2d');
        const movieGenreChart = new Chart(movieGenreCtx, {
            type: 'bar',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.MoviesByGenre.Keys.Select(k => $"'{k}'")))],
                datasets: [{
                    label: 'Số lượng phim',
                    data: [@string.Join(",", Model.MoviesByGenre.Values)],
                    backgroundColor: '#3498db',
                    borderColor: '#2980b9',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
}
