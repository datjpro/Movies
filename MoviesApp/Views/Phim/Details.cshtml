@model MoviesApp.Models.Phim

@{
    ViewData["Title"] = Model.TenPhim + " - Chi tiết phim";
    Layout = "_Layout";
}

<div class="container-fluid mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index"><i class="fas fa-home"></i> Trang chủ</a></li>
            <li class="breadcrumb-item"><a asp-action="Index">Phim</a></li>
            <li class="breadcrumb-item active" aria-current="page">@Model.TenPhim</li>
        </ol>
    </nav>

    <!-- Movie Header Banner -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white shadow-lg border-0">
                <div class="card-body text-center py-4">
                    <h1 class="display-4 fw-bold mb-2">@Model.TenPhim</h1>
                    <div class="d-flex justify-content-center align-items-center flex-wrap">
                        @if (Model.NamPhatHanh.HasValue)
                        {
                            <span class="badge bg-light text-dark me-2 mb-2">
                                <i class="fas fa-calendar me-1"></i>@Model.NamPhatHanh
                            </span>
                        }
                        @if (Model.TheLoaiPhim != null)
                        {
                            <span class="badge bg-warning text-dark me-2 mb-2 px-3 py-2">
                                <i class="fas fa-theater-masks me-1"></i>@Model.TheLoaiPhim.TenTL
                            </span>
                        }
                        @if (Model.QuocGia != null)
                        {
                            <span class="badge bg-info me-2 mb-2 px-3 py-2">
                                <i class="fas fa-globe me-1"></i>@Model.QuocGia.TenQG
                            </span>
                        }
                        @if (!string.IsNullOrEmpty(Model.TinhTrang))
                        {
                            <span class="badge bg-success me-2 mb-2 px-3 py-2">
                                <i class="fas fa-check-circle me-1"></i>@Model.TinhTrang
                            </span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Movie Poster and Basic Info -->
        <div class="col-lg-4 col-md-5">
            <div class="card shadow-lg">
                <div class="card-body text-center">
                    @if (!string.IsNullOrEmpty(Model.AnhPhim))
                    {
                        <img src="@Model.AnhPhim" alt="@Model.TenPhim" class="img-fluid rounded mb-3" style="max-height: 500px; width: 100%; object-fit: cover;">
                    }
                    else
                    {
                        <div class="bg-light rounded d-flex align-items-center justify-content-center mb-3" style="height: 500px;">
                            <i class="fas fa-film fa-5x text-muted"></i>
                        </div>
                    }
                    
                    <h4 class="card-title text-primary">@Model.TenPhim</h4>
                    
                    @if (Model.NamPhatHanh.HasValue)
                    {
                        <p class="text-muted mb-2">
                            <i class="fas fa-calendar-alt me-2"></i>@Model.NamPhatHanh
                        </p>
                    }
                    
                    @if (Model.ThoiLuongPhim.HasValue)
                    {
                        <p class="text-muted mb-2">
                            <i class="fas fa-clock me-2"></i>@Model.ThoiLuongPhim phút
                        </p>
                    }
                    
                    @if (!string.IsNullOrEmpty(Model.TinhTrang))
                    {
                        <span class="badge bg-success mb-3">@Model.TinhTrang</span>
                    }
                </div>
            </div>
            
            <!-- Rating and Stats -->
            @if (Model.DiemImdb.HasValue || Model.DiemMetascore.HasValue || Model.LuotVoteImdb.HasValue)
            {
                <div class="card shadow mt-3">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0">
                            <i class="fas fa-star me-2"></i>Đánh giá
                        </h6>
                    </div>
                    <div class="card-body">
                        @if (Model.DiemImdb.HasValue)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span><i class="fab fa-imdb text-warning"></i> IMDb</span>
                                <span class="badge bg-warning text-dark">@Model.DiemImdb/10</span>
                            </div>
                        }
                        
                        @if (Model.DiemMetascore.HasValue)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>Metascore</span>
                                <span class="badge bg-info">@Model.DiemMetascore/100</span>
                            </div>
                        }
                        
                        @if (Model.LuotVoteImdb.HasValue)
                        {
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Lượt vote</span>
                                <span class="text-muted">@Model.LuotVoteImdb.Value.ToString("N0")</span>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
        
        <!-- Movie Details -->
        <div class="col-lg-8 col-md-7">
            <!-- Movie Synopsis -->
            @if (!string.IsNullOrEmpty(Model.MoTaPhim))
            {
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-header bg-gradient-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-align-left me-2"></i>Tóm tắt nội dung
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="lead text-justify">@Model.MoTaPhim</p>
                    </div>
                </div>
            }

            <!-- Technical Details -->
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-gradient-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Thông tin kỹ thuật
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item mb-3">
                                <strong class="text-primary"><i class="fas fa-tag me-2"></i>Mã phim:</strong>
                                <span class="badge bg-light text-dark ms-2">@Model.MaPhim</span>
                            </div>
                            
                            @if (Model.QuocGia != null)
                            {
                                <div class="info-item mb-3">
                                    <strong class="text-primary"><i class="fas fa-globe me-2"></i>Quốc gia:</strong>
                                    <span class="ms-2">@Model.QuocGia.TenQG</span>
                                </div>
                            }
                            
                            @if (Model.TheLoaiPhim != null)
                            {
                                <div class="info-item mb-3">
                                    <strong class="text-primary"><i class="fas fa-theater-masks me-2"></i>Thể loại:</strong>
                                    <span class="badge bg-warning text-dark ms-2">@Model.TheLoaiPhim.TenTL</span>
                                </div>
                            }
                            
                            @if (Model.DanhMuc != null)
                            {
                                <div class="info-item mb-3">
                                    <strong class="text-primary"><i class="fas fa-folder me-2"></i>Danh mục:</strong>
                                    <span class="badge bg-info ms-2">@Model.DanhMuc.TenDM</span>
                                </div>
                            }
                        </div>
                        
                        <div class="col-md-6">
                            @if (Model.NamPhatHanh.HasValue)
                            {
                                <div class="info-item mb-3">
                                    <strong class="text-primary"><i class="fas fa-calendar-alt me-2"></i>Năm phát hành:</strong>
                                    <span class="ms-2">@Model.NamPhatHanh</span>
                                </div>
                            }
                            
                            @if (Model.ThoiLuongPhim.HasValue)
                            {
                                <div class="info-item mb-3">
                                    <strong class="text-primary"><i class="fas fa-clock me-2"></i>Thời lượng:</strong>
                                    <span class="ms-2">@Model.ThoiLuongPhim phút</span>
                                </div>
                            }
                            
                            <div class="info-item mb-3">
                                <strong class="text-primary"><i class="fas fa-list-ol me-2"></i>Số tập:</strong>
                                <span class="badge bg-success ms-2">@Model.SoTap tập</span>
                            </div>
                            
                            @if (!string.IsNullOrEmpty(Model.TinhTrang))
                            {
                                <div class="info-item mb-3">
                                    <strong class="text-primary"><i class="fas fa-signal me-2"></i>Tình trạng:</strong>
                                    <span class="badge bg-success ms-2">@Model.TinhTrang</span>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Production Info -->
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-gradient-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-video me-2"></i>Thông tin sản xuất
                    </h5>
                </div>                <div class="card-body">
                    <div class="row">
                        <!-- Debug: Hiển thị thông tin OMDb (bao gồm cả null để kiểm tra) -->
                        <div class="col-12 mb-3">
                            <div class="alert alert-info">
                                <h6>Debug: Thông tin OMDb</h6>
                                <p><strong>Đạo diễn:</strong> "@(Model.DaoDien ?? "NULL")"</p>
                                <p><strong>Biên kịch:</strong> "@(Model.BienKich ?? "NULL")"</p>
                                <p><strong>Diễn viên:</strong> "@(Model.DienVien ?? "NULL")"</p>
                                <p><strong>Ngôn ngữ:</strong> "@(Model.NgonNgu ?? "NULL")"</p>
                                <p><strong>Quốc gia sản xuất:</strong> "@(Model.QuocGiaSanXuat ?? "NULL")"</p>
                                <p><strong>Xếp hạng:</strong> "@(Model.XepHang ?? "NULL")"</p>
                                <p><strong>Loại phim:</strong> "@(Model.LoaiPhim ?? "NULL")"</p>
                                <p><strong>IMDb ID:</strong> "@(Model.ImdbId ?? "NULL")"</p>
                            </div>
                        </div>
                        
                        @if (!string.IsNullOrEmpty(Model.DaoDien))
                        {
                            <div class="col-md-6 mb-3">
                                <div class="production-info">
                                    <h6 class="text-warning"><i class="fas fa-user-tie me-2"></i>Đạo diễn</h6>
                                    <p class="mb-0">@Model.DaoDien</p>
                                </div>
                            </div>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.BienKich))
                        {
                            <div class="col-md-6 mb-3">
                                <div class="production-info">
                                    <h6 class="text-warning"><i class="fas fa-pen me-2"></i>Biên kịch</h6>
                                    <p class="mb-0">@Model.BienKich</p>
                                </div>
                            </div>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.QuocGiaSanXuat))
                        {
                            <div class="col-md-6 mb-3">
                                <div class="production-info">
                                    <h6 class="text-warning"><i class="fas fa-flag me-2"></i>Quốc gia sản xuất</h6>
                                    <p class="mb-0">@Model.QuocGiaSanXuat</p>
                                </div>
                            </div>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.XepHang))
                        {
                            <div class="col-md-6 mb-3">
                                <div class="production-info">
                                    <h6 class="text-warning"><i class="fas fa-certificate me-2"></i>Xếp hạng</h6>
                                    <span class="badge bg-secondary">@Model.XepHang</span>
                                </div>
                            </div>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.LoaiPhim))
                        {
                            <div class="col-md-6 mb-3">
                                <div class="production-info">
                                    <h6 class="text-warning"><i class="fas fa-film me-2"></i>Loại phim</h6>
                                    <span class="badge bg-primary">@Model.LoaiPhim</span>
                                </div>
                            </div>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.NgonNgu))
                        {
                            <div class="col-md-6 mb-3">
                                <div class="production-info">
                                    <h6 class="text-warning"><i class="fas fa-language me-2"></i>Ngôn ngữ</h6>
                                    <p class="mb-0">@Model.NgonNgu</p>
                                </div>
                            </div>
                        }
                        
                        @if (Model.NgayKhoiChieu.HasValue)
                        {
                            <div class="col-md-6 mb-3">
                                <div class="production-info">
                                    <h6 class="text-warning"><i class="fas fa-calendar-check me-2"></i>Ngày khởi chiếu</h6>
                                    <p class="mb-0">@Model.NgayKhoiChieu.Value.ToString("dd/MM/yyyy")</p>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Cast and Crew -->
            @if (!string.IsNullOrEmpty(Model.DienVien))
            {
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-header bg-gradient-secondary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>Diễn viên
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="lead">@Model.DienVien</p>
                    </div>
                </div>
            }

            <!-- Awards and Recognition -->            @if (!string.IsNullOrEmpty(Model.GiaiThuong))
            {
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-header bg-gradient-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-trophy me-2"></i>Giải thưởng & Thành tích
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="lead">@Model.GiaiThuong</p>
                    </div>
                </div>
            }

            <!-- IMDb Information -->
            @if (Model.DiemImdb.HasValue || Model.DiemMetascore.HasValue || Model.LuotVoteImdb.HasValue || !string.IsNullOrEmpty(Model.ImdbId))
            {
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-header bg-gradient-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fab fa-imdb me-2"></i>Thông tin IMDb
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            @if (Model.DiemImdb.HasValue)
                            {
                                <div class="col-md-6 mb-3">
                                    <div class="text-center">
                                        <div class="display-4 text-warning mb-2">
                                            <i class="fas fa-star"></i> @Model.DiemImdb.Value.ToString("0.0")
                                        </div>
                                        <small class="text-muted">IMDb Rating</small>
                                    </div>
                                </div>
                            }
                            
                            @if (Model.DiemMetascore.HasValue)
                            {
                                <div class="col-md-6 mb-3">
                                    <div class="text-center">
                                        <div class="display-4 text-info mb-2">
                                            @Model.DiemMetascore.Value
                                        </div>
                                        <small class="text-muted">Metascore</small>
                                    </div>
                                </div>
                            }
                            
                            @if (Model.LuotVoteImdb.HasValue)
                            {
                                <div class="col-12 mb-3">
                                    <div class="text-center">
                                        <p class="mb-0">
                                            <i class="fas fa-users me-2"></i>
                                            <strong>@Model.LuotVoteImdb.Value.ToString("N0")</strong> lượt đánh giá trên IMDb
                                        </p>
                                    </div>
                                </div>
                            }
                            
                            @if (!string.IsNullOrEmpty(Model.ImdbId))
                            {
                                <div class="col-12">
                                    <div class="text-center">
                                        <p class="text-muted mb-2">IMDb ID: <code>@Model.ImdbId</code></p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }

            <!-- External Links -->
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-gradient-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-external-link-alt me-2"></i>Liên kết ngoài
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-2">
                        @if (!string.IsNullOrEmpty(Model.ImdbId))
                        {
                            <a href="https://www.imdb.com/title/@Model.ImdbId" target="_blank" class="btn btn-outline-warning">                                <i class="fab fa-imdb me-2"></i>Xem trên IMDb
                            </a>
                        }
                        
                        <button class="btn btn-outline-primary" onclick="shareMovie()">
                            <i class="fas fa-share-alt me-2"></i>Chia sẻ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card shadow-lg border-0">
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <a asp-action="Index" class="btn btn-secondary btn-lg">
                            <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
                        </a>
                        <a asp-action="Edit" asp-route-id="@Model.MaPhim" class="btn btn-primary btn-lg">
                            <i class="fas fa-edit me-2"></i>Chỉnh sửa
                        </a>
                        <a asp-action="Delete" asp-route-id="@Model.MaPhim" class="btn btn-danger btn-lg">
                            <i class="fas fa-trash me-2"></i>Xóa
                        </a>
                        <button class="btn btn-success btn-lg" onclick="addToFavorites('@Model.MaPhim')">
                            <i class="fas fa-heart me-2"></i>Yêu thích
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Episodes Section -->
    @if (Model.TapPhims != null && Model.TapPhims.Any())
    {
        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-gradient-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-play-circle me-2"></i>Danh sách tập phim 
                            <span class="badge bg-light text-info ms-2">@Model.TapPhims.Count tập</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            @foreach (var tap in Model.TapPhims.OrderBy(t => t.SoTapThuTu))
                            {
                                <div class="col-xl-3 col-lg-4 col-md-6 mb-3">
                                    <div class="card h-100 shadow-sm border-0 episode-card">
                                        <div class="card-body text-center">
                                            <div class="episode-number mb-2">
                                                <span class="badge bg-primary fs-6 p-2">Tập @tap.SoTapThuTu</span>
                                            </div>
                                            @if (!string.IsNullOrEmpty(tap.TenTap))
                                            {
                                                <h6 class="card-title text-truncate">@tap.TenTap</h6>
                                            }
                                            @if (tap.ThoiLuongTap.HasValue)
                                            {
                                                <small class="text-muted">
                                                    <i class="fas fa-clock me-1"></i>@tap.ThoiLuongTap phút
                                                </small>
                                            }
                                            <div class="mt-2">
                                                <button class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-play me-1"></i>Xem
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Statistics Section -->
    @if (Model.ThongKePhim != null)
    {
        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-gradient-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Thống kê xem phim
                        </h5>
                    </div>
                    <div class="card-body">                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <i class="fas fa-eye fa-2x text-primary mb-2"></i>
                                    <h4 class="text-primary">@((Model.ThongKePhim?.TongLuotXem ?? 0).ToString("N0"))</h4>
                                    <p class="text-muted">Lượt xem</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <i class="fas fa-star fa-2x text-warning mb-2"></i>
                                    <h4 class="text-warning">@((Model.ThongKePhim?.DiemTrungBinh ?? 0).ToString("F1"))</h4>
                                    <p class="text-muted">Điểm trung bình</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <i class="fas fa-comments fa-2x text-info mb-2"></i>
                                    <h4 class="text-info">@((Model.ThongKePhim?.SoLuotDanhGia ?? 0).ToString("N0"))</h4>
                                    <p class="text-muted">Lượt đánh giá</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <i class="fas fa-calendar-alt fa-2x text-success mb-2"></i>
                                    <h4 class="text-success">@(Model.ThongKePhim?.NgayCapNhat.ToString("dd/MM") ?? "N/A")</h4>
                                    <p class="text-muted">Cập nhật cuối</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .episode-card {
        transition: transform 0.2s ease-in-out;
    }
    
    .episode-card:hover {
        transform: translateY(-5px);
    }
    
    .info-item {
        border-left: 3px solid #007bff;
        padding-left: 15px;
    }
    
    .production-info {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #ffc107;
    }
    
    .stat-item {
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(45deg, #007bff, #0056b3);
    }
    
    .bg-gradient-info {
        background: linear-gradient(45deg, #17a2b8, #138496);
    }
    
    .bg-gradient-warning {
        background: linear-gradient(45deg, #ffc107, #e0a800);
    }
    
    .bg-gradient-success {
        background: linear-gradient(45deg, #28a745, #20c997);
    }
    
    .bg-gradient-secondary {
        background: linear-gradient(45deg, #6c757d, #545b62);
    }
    
    .bg-gradient-dark {
        background: linear-gradient(45deg, #343a40, #23272b);
    }
</style>

@section Scripts {
    <script>
        // Share movie function
        function shareMovie() {
            if (navigator.share) {
                navigator.share({
                    title: '@Model.TenPhim',
                    text: 'Xem phim @Model.TenPhim trên CCFilm',
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Link đã được sao chép vào clipboard!');
                });
            }
        }
        
        // Add to favorites function
        function addToFavorites(movieId) {
            // Implementation for adding to favorites
            // This would typically make an AJAX call to your API
            alert('Đã thêm vào danh sách yêu thích!');
        }
        
        // Auto-hide alerts
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.transition = 'opacity 0.5s';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                }, 5000);
            });
        });
    </script>
}
