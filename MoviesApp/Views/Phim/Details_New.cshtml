@model MoviesApp.Models.Phim

@{
    ViewData["Title"] = Model.TenPhim + " - Chi tiết phim";
    Layout = "_Layout";
}

<!-- Movie Hero Section -->
<div class="movie-hero">
    <div class="hero-background">
        @if (!string.IsNullOrEmpty(Model.AnhPhim))
        {
            <img src="@Model.AnhPhim" alt="@Model.TenPhim" class="hero-bg-image">
        }
        <div class="hero-overlay"></div>
    </div>
    
    <div class="container">
        <div class="row align-items-center min-vh-50">
            <div class="col-lg-4">
                <div class="movie-poster-main">
                    <img src="@(Model.AnhPhim ?? "/images/no-image.jpg")" 
                         alt="@Model.TenPhim" 
                         class="poster-image"
                         onerror="this.src='/images/no-image.jpg'">
                    @if (Model.DiemImdb.HasValue)
                    {
                        <div class="rating-badge">
                            <i class="fas fa-star"></i>
                            <span>@Model.DiemImdb.Value.ToString("F1")</span>
                        </div>
                    }
                </div>
            </div>
            
            <div class="col-lg-8">
                <div class="movie-info-main">
                    <div class="breadcrumb-custom mb-3">
                        <a asp-controller="Home" asp-action="Index">Trang chủ</a>
                        <span>/</span>
                        <a asp-action="Index">Phim</a>
                        <span>/</span>
                        <span class="current">@Model.TenPhim</span>
                    </div>
                    
                    <h1 class="movie-title">@Model.TenPhim</h1>
                    
                    <div class="movie-meta">
                        @if (Model.NamPhatHanh.HasValue)
                        {
                            <span class="meta-item">
                                <i class="fas fa-calendar"></i>
                                @Model.NamPhatHanh
                            </span>
                        }
                        @if (Model.ThoiLuongPhim.HasValue)
                        {
                            <span class="meta-item">
                                <i class="fas fa-clock"></i>
                                @Model.ThoiLuongPhim phút
                            </span>
                        }
                        @if (Model.TheLoaiPhim != null)
                        {
                            <span class="meta-item">
                                <i class="fas fa-theater-masks"></i>
                                @Model.TheLoaiPhim.TenTL
                            </span>
                        }
                        @if (Model.QuocGia != null)
                        {
                            <span class="meta-item">
                                <i class="fas fa-globe"></i>
                                @Model.QuocGia.TenQG
                            </span>
                        }
                    </div>
                    
                    @if (!string.IsNullOrEmpty(Model.MoTaPhim))
                    {
                        <p class="movie-description">@Model.MoTaPhim</p>
                    }
                    
                    <div class="action-buttons">
                        @if (!string.IsNullOrEmpty(Model.ImdbId))
                        {
                            <a href="https://www.imdb.com/title/@Model.ImdbId" target="_blank" class="btn btn-primary">
                                <i class="fab fa-imdb"></i>
                                Xem trên IMDb
                            </a>
                        }
                        
                        @if (User.IsInRole("Admin") || User.IsInRole("User"))
                        {
                            <a asp-action="Edit" asp-route-id="@Model.MaPhim" class="btn btn-warning">
                                <i class="fas fa-edit"></i>
                                Chỉnh sửa
                            </a>
                        }
                        
                        @if (User.IsInRole("Admin"))
                        {
                            <a asp-action="Delete" asp-route-id="@Model.MaPhim" class="btn btn-danger">
                                <i class="fas fa-trash"></i>
                                Xóa phim
                            </a>
                        }
                        
                        <button class="btn btn-outline-light" onclick="shareMovie()">
                            <i class="fas fa-share"></i>
                            Chia sẻ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Movie Details Content -->
<div class="container my-5">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Movie Information -->
            <div class="card content-card mb-4">
                <div class="card-header">
                    <h3><i class="fas fa-info-circle me-2"></i>Thông tin chi tiết</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-group">
                                <strong>Đạo diễn:</strong>
                                <span>@(Model.DaoDien ?? "Chưa cập nhật")</span>
                            </div>
                            <div class="info-group">
                                <strong>Biên kịch:</strong>
                                <span>@(Model.BienKich ?? "Chưa cập nhật")</span>
                            </div>
                            <div class="info-group">
                                <strong>Diễn viên:</strong>
                                <span>@(Model.DienVien ?? "Chưa cập nhật")</span>
                            </div>
                            <div class="info-group">
                                <strong>Thể loại:</strong>
                                <span>@(Model.TheLoaiPhim?.TenTL ?? "Chưa cập nhật")</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-group">
                                <strong>Quốc gia:</strong>
                                <span>@(Model.QuocGia?.TenQG ?? "Chưa cập nhật")</span>
                            </div>
                            <div class="info-group">
                                <strong>Ngôn ngữ:</strong>
                                <span>@(Model.NgonNgu ?? "Chưa cập nhật")</span>
                            </div>
                            <div class="info-group">
                                <strong>Số tập:</strong>
                                <span>@Model.SoTap tập</span>
                            </div>
                            <div class="info-group">
                                <strong>Tình trạng:</strong>
                                <span class="badge bg-success">@(Model.TinhTrang ?? "Chưa cập nhật")</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Awards & Ratings -->
            @if (!string.IsNullOrEmpty(Model.GiaiThuong) || Model.DiemImdb.HasValue || Model.DiemMetascore.HasValue)
            {
                <div class="card content-card mb-4">
                    <div class="card-header">
                        <h3><i class="fas fa-trophy me-2"></i>Đánh giá & Giải thưởng</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            @if (Model.DiemImdb.HasValue)
                            {
                                <div class="col-md-4">
                                    <div class="rating-box">
                                        <div class="rating-score">@Model.DiemImdb.Value.ToString("F1")</div>
                                        <div class="rating-label">
                                            <i class="fab fa-imdb"></i>
                                            IMDb
                                        </div>
                                        @if (Model.LuotVoteImdb.HasValue)
                                        {
                                            <div class="rating-votes">@Model.LuotVoteImdb.Value.ToString("N0") lượt vote</div>
                                        }
                                    </div>
                                </div>
                            }
                            @if (Model.DiemMetascore.HasValue)
                            {
                                <div class="col-md-4">
                                    <div class="rating-box">
                                        <div class="rating-score">@Model.DiemMetascore.Value</div>
                                        <div class="rating-label">Metascore</div>
                                    </div>
                                </div>
                            }
                            @if (!string.IsNullOrEmpty(Model.XepHang))
                            {
                                <div class="col-md-4">
                                    <div class="rating-box">
                                        <div class="rating-score">@Model.XepHang</div>
                                        <div class="rating-label">Xếp hạng</div>
                                    </div>
                                </div>
                            }
                        </div>
                        
                        @if (!string.IsNullOrEmpty(Model.GiaiThuong))
                        {
                            <div class="mt-3">
                                <strong>Giải thưởng:</strong>
                                <p class="text-muted mb-0">@Model.GiaiThuong</p>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Quick Stats -->
            <div class="card content-card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar me-2"></i>Thống kê</h5>
                </div>
                <div class="card-body">
                    @if (Model.ThongKePhim != null)
                    {
                        <div class="stat-item">
                            <span class="stat-number">@Model.ThongKePhim.TongLuotXem.ToString("N0")</span>
                            <span class="stat-label">Lượt xem</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">@Model.ThongKePhim.DiemTrungBinh.ToString("F1")</span>
                            <span class="stat-label">Điểm trung bình</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">@Model.ThongKePhim.SoLuotDanhGia.ToString("N0")</span>
                            <span class="stat-label">Lượt đánh giá</span>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted">Chưa có thống kê</p>
                    }
                </div>
            </div>
            
            <!-- Additional Info -->
            <div class="card content-card">
                <div class="card-header">
                    <h5><i class="fas fa-calendar me-2"></i>Thông tin khác</h5>
                </div>
                <div class="card-body">
                    <div class="info-group">
                        <strong>Ngày tạo:</strong>
                        <span>@Model.NgayTao.ToString("dd/MM/yyyy")</span>
                    </div>
                    @if (Model.NgayKhoiChieu.HasValue)
                    {
                        <div class="info-group">
                            <strong>Ngày khởi chiếu:</strong>
                            <span>@Model.NgayKhoiChieu.Value.ToString("dd/MM/yyyy")</span>
                        </div>
                    }
                    <div class="info-group">
                        <strong>Mã phim:</strong>
                        <span class="font-monospace">@Model.MaPhim</span>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.ImdbId))
                    {
                        <div class="info-group">
                            <strong>IMDb ID:</strong>
                            <span class="font-monospace">@Model.ImdbId</span>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS -->
<style>
.movie-hero {
    position: relative;
    color: white;
    overflow: hidden;
}

.hero-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: -1;
}

.hero-bg-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: blur(3px);
    transform: scale(1.1);
}

.hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.6) 100%);
}

.min-vh-50 {
    min-height: 60vh;
}

.movie-poster-main {
    position: relative;
    max-width: 300px;
    margin: 0 auto;
}

.poster-image {
    width: 100%;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.rating-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255,193,7,0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    font-weight: bold;
    backdrop-filter: blur(10px);
}

.movie-info-main {
    padding: 2rem 0;
}

.breadcrumb-custom {
    color: rgba(255,255,255,0.8);
}

.breadcrumb-custom a {
    color: rgba(255,255,255,0.8);
    text-decoration: none;
}

.breadcrumb-custom a:hover {
    color: white;
}

.breadcrumb-custom .current {
    color: white;
    font-weight: 500;
}

.movie-title {
    font-size: 3rem;
    font-weight: 700;
    margin: 1rem 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

.movie-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin: 1.5rem 0;
}

.meta-item {
    background: rgba(255,255,255,0.1);
    padding: 8px 15px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.meta-item i {
    margin-right: 5px;
}

.movie-description {
    font-size: 1.1rem;
    line-height: 1.6;
    margin: 1.5rem 0;
    color: rgba(255,255,255,0.9);
}

.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 2rem;
}

.action-buttons .btn {
    padding: 12px 24px;
    border-radius: 25px;
    font-weight: 500;
    backdrop-filter: blur(10px);
}

.content-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    overflow: hidden;
}

.content-card .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 1rem 1.5rem;
}

.content-card .card-header h3,
.content-card .card-header h5 {
    margin: 0;
    font-weight: 600;
}

.info-group {
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #eee;
}

.info-group:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.info-group strong {
    display: inline-block;
    width: 120px;
    color: #666;
    font-size: 0.9rem;
}

.rating-box {
    text-align: center;
    padding: 1.5rem 1rem;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 1rem;
}

.rating-score {
    font-size: 2.5rem;
    font-weight: bold;
    color: #ffc107;
}

.rating-label {
    font-weight: 600;
    color: #666;
    margin-top: 0.5rem;
}

.rating-votes {
    font-size: 0.8rem;
    color: #999;
    margin-top: 0.25rem;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #eee;
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
}

.stat-label {
    color: #666;
    font-size: 0.9rem;
}

@@media (max-width: 768px) {
    .movie-title {
        font-size: 2rem;
    }
    
    .movie-meta {
        justify-content: center;
    }
    
    .action-buttons {
        justify-content: center;
    }
    
    .info-group strong {
        width: 100px;
        font-size: 0.8rem;
    }
}
</style>

<!-- JavaScript -->
<script>
function shareMovie() {
    if (navigator.share) {
        navigator.share({
            title: '@Model.TenPhim',
            text: '@(Model.MoTaPhim ?? "Chi tiết phim")',
            url: window.location.href
        });
    } else {
        // Fallback - copy to clipboard
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('Đã sao chép link phim vào clipboard!');
        });
    }
}

// Smooth scroll to sections
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>
